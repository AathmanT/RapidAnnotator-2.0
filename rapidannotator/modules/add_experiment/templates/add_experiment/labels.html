{% extends "add_experiment/base.html" %}
{% from "macros.html" import render_field %}

{% block title %} Add Experiment Page {% endblock title %}
{% block head %}
  {{ super() }}
  <style type="text/css">
    .important { color: #336699; }
  </style>
{% endblock head %}

{% block experiment_body %}

<div class="container">
</div>

<div class="container">
    <h5><a>Home</a> > <a>Add Experiments</a> > <a>Labels</a></h5>
</div>

<div class="container">

    <div style="display: inline-block">
        <h3 style="display: inline"><b>{{ experiment.name }}</b></h3>
    </div>

    <div class="pull-right" style="display: inline-block">

        <button type="button" data-toggle="modal" data-target="#addLabelLevel"
            class="btn btn-primary btn-group btn-group-inline btn-space">{{ ('Add Annotation Level') }}</button>

        <a href="{{ url_for('add_experiment.editLables', experimentId = experiment.id) }}" class="btn btn-success btn-group btn-group-inline btn-space">{{ ('Done') }}</a>

        </div>

        <hr class="horizontal-line">

</div>

<div class="modal fade" id="addLabelLevel" role="dialog" tabindex="-1"
    aria-labelledby="addLabelLevel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Enter Level Details</h4>
      </div>
        <div class="modal-body">
            <form method="POST" id="addLabelLevelForm" name="addLabelLevelForm" action = "{{ url_for('add_experiment._addAnnotationLevel') }}">
                {% for field in annotationLevelForm %}
                    {% if field.widget.input_type == 'hidden' %}
                    {{ field() }}
                    {% else %}
                    {{ render_field(field, autofocus=True, placeholder=field.label.text) }}
                    {% endif %}
                {% endfor %}
                <div class="form-actions">
                    <button type="submit" name="submit" value="logout" class="btn btn-primary"><i class="fa fa-check"></i> {{ ('Submit') }}</button>
                    <button type="button" id="submitLater" class="btn btn-default pull-right" data-dismiss="modal">{{ ('Submit later') }}</button>
                </div>
            </form>
        </div>
        <div class="modal-footer">
        </div>
    </div>
  </div>
</div>


<div class="container">
    {{annotation_levels}}
</div>

<script charset="utf-8" type="text/javascript">
    $(function() {

        var selectedOwner = $('#addOwnersMenu li a');
        var selectedAnnotator = $('#addAnnotatorsMenu li a');
        var displayTimeForm = $('#displayTimeForm');
        var submitLater = $('#submitLater');

        displayTimeForm.on('submit', function(e) {
            e.stopImmediatePropagation();
            e.preventDefault();
            var beforeTime = $('input[name="beforeTime"]').val();
            var afterTime = $('input[name="afterTime"]').val();
            setDisplayTime(beforeTime, afterTime);
        });

        submitLater.on('click', function() {
            setDisplayTime(0, -1);
        });

        function setDisplayTime(beforeTime, afterTime) {
            var url = "{{ url_for('add_experiment._addDisplayTimeDetails')}}";
            var data = {
                'beforeTime' : beforeTime,
                'afterTime' : afterTime,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    $('#displayTimeModalId').modal('hide');
                }
                else {
                    /*do something here*/
                }
            });
        }

        selectedOwner.on('click', function() {

            var currentSelected = $(this);
            var userName = currentSelected.text();
            var url = "{{ url_for('add_experiment._addOwner')}}";
            var data = {
                'userName' : userName,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    currentSelected.remove();
                }
                else {
                    /*do something here*/
                }
            });
        });

        selectedAnnotator.on('click', function() {

            var currentSelected = $(this);
            var userName = currentSelected.text();
            var url = "{{ url_for('add_experiment._addAnnotator')}}";
            var data = {
                'userName' : userName,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    currentSelected.remove();
                }
                else {
                    /*do something here*/
                }
            });
        });


    });
</script>

{% endblock experiment_body %}
