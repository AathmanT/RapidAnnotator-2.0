{% extends "add_experiment/base.html" %}
{% from "macros.html" import render_field %}

{% block title %} Add Experiment Page {% endblock title %}
{% block head %}
  {{ super() }}
  <style type="text/css">
    .important { color: #336699; }
  </style>
{% endblock head %}

{% block experiment_body %}

<div class="container">
</div>

<div class="container">
    <h5><a>Home</a> > <a>Add Experiments</a></h5>
</div>

<div class="container">

    <div style="display: inline-block">
        <h3 style="display: inline"><b>{{ experiment.name }}</b></h3>
    </div>

    <div class="pull-right" style="display: inline-block">
        <button type="button" class="btn btn-primary btn-group btn-group-inline btn-space">Add Labels</button>

        <div class="dropdown btn-group btn-group-inline btn-space">
            <button class="btn btn-primary dropdown-toggle" type="button" id="addOwners" data-toggle="dropdown">
                Add Owner
            <span class="caret"></span></button>
            <ul class="dropdown-menu scrollable-dropdown" id="addOwnersMenu" role="menu" aria-labelledby="addOwners">
                {% for user in notOwners %}
                <li role="presentation"><a role="menuitem" tabindex="-1" href="#">{{user.fullname}}</a></li>
                {% endfor %}
            </ul>
        </div>

            <div class="dropdown btn-group btn-group-inline btn-space">
                <button class="btn btn-primary dropdown-toggle" type="button" id="addAnnotators" data-toggle="dropdown">
                    Add Annotator
                <span class="caret"></span></button>
                <ul class="dropdown-menu scrollable-dropdown" id="addAnnotatorsMenu" role="menu" aria-labelledby="addAnnotators">
                    {% for user in notAnnotators %}
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#">{{user.fullname}}</a></li>
                    {% endfor %}
                </ul>
            </div>

            <button type="button" class="btn btn-success btn-group btn-group-inline btn-space">Done</button>

        </div>

        <hr class="horizontal-line">

</div>

<div class="modal fade" id="displayTimeModalId" role="dialog" tabindex="-1"
    aria-labelledby="displayTimeModalId" aria-hidden="true" data-backdrop="static"
    data-keyboard="false">
  <div class="modal-dialog modal-sm">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Enter the play time details of the clips</h4>
      </div>
        <div class="modal-body">
            <form method="POST" id="displayTimeForm" name="logout_form" action = "{{ url_for('add_experiment._addDisplayTimeDetails') }}">

                <b>Before Time</b>
                <input type="number" name="beforeTime" id="beforeTime" class="form-control validate" placeholder="Before Time(in secs) Example : 65">
                <span class="help-block"><small>The time relative to the time given in the link to before which the clip will start.</small></span>

                <b>After Time</b>
                <input type="number" name="afterTime" id="afterTime" class="form-control validate" placeholder="After Time(in secs) Example : 5">
                <span class="help-block"><small>The time relative to the time given in the link till which the clip will be played.</small></span>

                <div class="form-actions">
                    <button type="submit" name="submit" value="logout" class="btn btn-primary"><i class="fa fa-check"></i> {{ ('Submit') }}</button>
                    <button type="button" id="submitLater" class="btn btn-default pull-right" data-dismiss="modal">{{ ('Submit later') }}</button>
                </div>
            </form>
        </div>
        <div class="modal-footer">
        </div>
    </div>
  </div>
</div>


<div class="container">
</div>

<script charset="utf-8" type="text/javascript">
    $(function() {

        category = "{{ experiment.category }}";
        dt = "{{ experiment.display_time }}";
        if( dt == "None" && (category  === "audio" || category === "video") ) {
            $('#displayTimeModalId').modal('show');
        }

        var selectedOwner = $('#addOwnersMenu li a');
        var selectedAnnotator = $('#addAnnotatorsMenu li a');
        var displayTimeForm = $('#displayTimeForm');
        var submitLater = $('#submitLater');

        displayTimeForm.on('submit', function(e) {
            e.stopImmediatePropagation();
            e.preventDefault();
            var beforeTime = $('input[name="beforeTime"]').val();
            var afterTime = $('input[name="afterTime"]').val();
            setDisplayTime(beforeTime, afterTime);
        });

        submitLater.on('click', function() {
            setDisplayTime(0, -1);
        });

        function setDisplayTime(beforeTime, afterTime) {
            var url = "{{ url_for('add_experiment._addDisplayTimeDetails')}}";
            var data = {
                'beforeTime' : beforeTime,
                'afterTime' : afterTime,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    $('#displayTimeModalId').modal('hide');
                }
                else {
                    /*do something here*/
                }
            });
        }

        selectedOwner.on('click', function() {

            var currentSelected = $(this);
            var userName = currentSelected.text();
            var url = "{{ url_for('add_experiment._addOwner')}}";
            var data = {
                'userName' : userName,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    currentSelected.remove();
                }
                else {
                    /*do something here*/
                }
            });
        });

        selectedAnnotator.on('click', function() {

            var currentSelected = $(this);
            var userName = currentSelected.text();
            var url = "{{ url_for('add_experiment._addAnnotator')}}";
            var data = {
                'userName' : userName,
                'experimentId' : {{ experiment.id }},
            };

            $.getJSON(url , data, function(response) {
                if(response.success) {
                    console.log(response);
                    currentSelected.remove();
                }
                else {
                    /*do something here*/
                }
            });
        });


    });
</script>

{% endblock experiment_body %}
